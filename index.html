<!DOCTYPE HTML>
<html>
<title>Piano</title>
<head>
	
	<script src ="js/caat.js"> </script>
	<script src="./js/MIDI/AudioDetect.js" type="text/javascript"></script>
	<script src="./js/MIDI/LoadPlugin.js" type="text/javascript"></script>
	<script src="./js/MIDI/Plugin.js" type="text/javascript"></script>
	<script src="./js/MIDI/Player.js" type="text/javascript"></script>
	<script src="./js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
	<script src="./js/Window/DOMLoader.script.js" type="text/javascript"></script>
	<!-- jasmid package -->
	<script src="./inc/jasmid/stream.js"></script>
	<script src="./inc/jasmid/midifile.js"></script>
	<script src="./inc/jasmid/replayer.js"></script>
	<!-- extras -->
	<script src="./inc/Base64.js" type="text/javascript"></script>
	 <script src="./inc/base64binary.js" type="text/javascript"></script>
	<script src ="js/loadAudio.js"> </script>
	<script src ="js/sound.js"> </script>
	<script src ="js/button.js"> </script>
	<script src ="js/main.js"> </script>
	<script src ="js/pianoKey.js"> </script>
	<script src ="js/keyData.js"> </script>
	<script> 
	/*
	var loader = new widgets.Loader({
		id: "loader",
		bars: 12,
		radius: 20,
		lineWidth: 3,
		lineHeight: 10
	});
	loader.stop();	

	loader.message("New loading message...");

*/

if (typeof(widgets) === "undefined") widgets = {};

(function(root) {

var PI = Math.PI;
var defaultConfig = { 
	id: "loader",
	bars: 12,
	radius: 0,
	lineWidth: 20,
	lineHeight: 70
};

root.Loader = function (config) {
	var that = this;
	if (!document.body) return;
	if (!config) config = {};
	for (var key in defaultConfig) {
		if (typeof(config[key]) === "undefined") {
			config[key] = defaultConfig[key];
		}
	}
	//
	var canvas = document.getElementById(config.id);
	if (!canvas) {
		var div = document.createElement("div");
		div.style.cssText = "color: #fff; pointer-events: none; -webkit-transition-property: opacity; -webkit-transition-duration: .5s; position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 10000; background: rgba(0,0,0,0.5); opacity: 1";
		if (config.message) {
			var span = document.createElement("span");
			span.style.cssText = "font-family: courier; opacity: 1; display: inline-block;background: rgba(0,0,0,0.65); border-radius: 10px; padding: 10px; width: 200px; text-align: center; position: absolute; z-index: 1000;";
			div.appendChild(span);
			that.span = span;
		}
		var canvas = document.createElement("canvas");
		document.body.appendChild(canvas);
		canvas.id = config.id;
		canvas.style.cssText = "opacity: 1; position: absolute; z-index: 1000;";
		div.appendChild(canvas);
		document.body.appendChild(div);
	}
	if (window.innerWidth && window.innerHeight) {
		var width = window.innerWidth;
		var height = window.innerHeight;
	} else if (document.body && document.body.offsetWidth) {
		var width = document.body.offsetWidth;
		var height = document.body.offsetHeight;
	} else if (document.compatMode === "CSS1Compat" && document.documentElement && document.documentElement.offsetWidth ) {
		var width = document.documentElement.offsetWidth;
		var height = document.documentElement.offsetHeight;
	}
	var max = config.lineHeight + 20;
	var size = max * 2 + config.radius;
	width -= size;
	height -= size;
	canvas.width = size;
	canvas.height = size;
	canvas.style.left = (width / 2) + "px";
	canvas.style.top = (height / 2) + "px";
	if (config.message) {
		that.span.style.left = ((width + size) / 2  - that.span.offsetWidth/2) + "px";
		that.span.style.top = (height / 2 + size - 10) + "px";
	}
	var that = this;
	var interval = 0;
	var offset = 0;
	var delay = config.delay;
	var bars = config.bars;
	var radius = config.radius;
	var ctx = canvas.getContext('2d');
	ctx.globalCompositeOperation = "lighter";
	ctx.shadowOffsetX = 1;
	ctx.shadowOffsetY = 1;
	ctx.shadowBlur = 1;
	ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
	//
	function animate() {
		ctx.save();
		ctx.clearRect(0, 0, size, size);
		ctx.translate(size / 2, size / 2);
		var hues = 360 - 360 / bars;
		for (var i = 0; i < bars; i++) {
			var angle = (i / bars * 2 * PI) + offset;
			ctx.save();
			ctx.translate(radius * Math.sin(-angle), radius * Math.cos(-angle));
			ctx.rotate(angle);
			// round-rect properties
			var x = -config.lineWidth / 2;
			var y = 0;
			var width = config.lineWidth;
			var height = config.lineHeight;
			var curve = width / 2;
			// round-rect path
			ctx.beginPath();
			ctx.moveTo(x + curve, y);
			ctx.lineTo(x + width - curve, y);
			ctx.quadraticCurveTo(x + width, y, x + width, y + curve);
			ctx.lineTo(x + width, y + height - curve);
			ctx.quadraticCurveTo(x + width, y + height, x + width - curve, y + height);
			ctx.lineTo(x + curve, y + height);
			ctx.quadraticCurveTo(x, y + height, x, y + height - curve);
			ctx.lineTo(x, y + curve);
			ctx.quadraticCurveTo(x, y, x + curve, y);
			// round-rect fill
			var hue = ((i / (bars - 1)) * hues);
			ctx.fillStyle = "hsla(" + hue + ", 100%, 50%, 0.85)";
			ctx.fill();
			ctx.restore();
		}
		ctx.restore();
		offset += 0.07;
		//
		if (config.messageAnimate) {
			var iteration = offset / 0.07 >> 0;
			if (iteration % 10 == 0) {
				var length = config.messageAnimate.length;
				var n = iteration / 10 % length;
				that.span.innerHTML = config.message + config.messageAnimate[n];
			}
		}
	};
	//
	this.message = function(message) {
		if (!interval) this.start();
		config.message = message;
		if (message.substr(-3) === "...") {
			config.message = message.substr(0, message.length - 3);
			config.messageAnimate = [ ".&nbsp;&nbsp;","..&nbsp;","..." ].reverse();
		} else {
			config.messageAnimate = false;
		}
		that.span.innerHTML = config.message + (config.messageAnimate[0] || "");
	};
	//
	this.stop = function () {
		if (interval) {
			window.clearInterval(interval);
			interval = 0;
		}
		if (canvas && canvas.style) {
			canvas.parentNode.style.opacity = 0;
			window.setTimeout(function () {
				canvas.parentNode.style.display = "none";
				ctx.clearRect(0, 0, size, size);
			}, 500);
		}
	};
	//
	this.start = function (max) {
		if (interval) return;
		canvas.parentNode.style.top = document.body.scrollTop + "px";
		canvas.parentNode.style.opacity = 1;
		canvas.parentNode.style.display = "block";
		canvas.style.left = (width / 2) + "px";
		canvas.style.top = (height / 2) + "px";
		if (!config.delay) animate();
		interval = window.setInterval(animate, 30);
		if (config.message) {
			this.message(config.message);
		}
	};
	//
	this.start(30 * 1000);
	//
	return this;
};

})(widgets);
	/*
	var loading=0;
	var buf=[],bufau1=[],bufau2=[];
	var aud=[], audg=[], audio=[];
	for (i=1;i<62;i++) {
	loading++;
	audio[i]= document.createElement('audio');
	audio[i].addEventListener("canplaythrough", function () {
	loading--;
	if (loading == 0) // All files are preloaded
	Start();
	}, false);
	buf[i]= new Audio();
	bufau1[i]=document.createElement('source');
	bufau2[i]=document.createElement('source');
	aud[i]=document.createElement('source');
	aud[i].type='audio/mpeg';
	aud[i].src = 'sound/sound'+i+'.mp3';
	audio[i].appendChild(aud[i]);
	audg[i]=document.createElement('source');
	audg[i].type='audio/ogg';
	audg[i].src = 'sound/sound'+i+'.ogg';
	audio[i].appendChild(audg[i]);
	bufau1[i].type=aud[i].type;bufau1[i].src=aud[i].src;
	bufau2[i].type=audg[i].type;bufau2[i].src=audg[i].src;
	buf[i].appendChild(bufau1[i]);
	buf[i].appendChild(bufau2[i]);
	audio[i].load();
	buf[i].load();

	}
	function bufaudio(num){
	buf[num].cloneNode(true).play();
	}
	function Start() {
	document.getElementById("loading").innerHTML="Done";
	}

	var shiftcode= [87,81,57,56,54,53,52,66,86,67,90,76,74,50,72,71,68,83,80,79,73,89,84,69,49];
	var keycode= [57,56,55,54,53,52,77,78,66,86,67,88,90,51,76,75,74,72,71,70,68,83,65,80,50,79,73,85,89,84,82,69,87,81,48,49];

	$(window).bind('keydown', function(e){

	for (i=0;i<61;i++){
	if (e.shiftKey){
	if (e.keyCode==shiftcode[i])
	{if (audio[i+1].currentTime>0&&audio[i+1].currentTime<audio[i+1].duration) bufaudio(i+1); else audio[i+1].play();}
	}
	 else if (e.keyCode==keycode[i-25])
	{if (audio[i+1].currentTime>0&&audio[i+1].currentTime<audio[i+1].duration) bufaudio(i+1); else audio[i+1].play();}

	}

	} );
	*/

	</script>
</head>
<body>
	<canvas id = "canvas" width = "800px" height = "600px">
		No canvas available
	</canvas>
</body>
</html>